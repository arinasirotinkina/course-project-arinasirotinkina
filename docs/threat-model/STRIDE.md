
# STRIDE — Threats mapping (для ключевых потоков/элементов)

>  набор угроз покрывает ключевой контур проекта (>=12 угроз).

| № | Поток / Элемент | Угроза (STRIDE) | Риск (ID) | Контроль (меры) | Ссылка на NFR | Проверка / Артефакт |
|---:|-----------------|------------------|----------|------------------|---------------|---------------------|
| 1 | F1 GET /wishes | I — возврат лишних полей (инфо) | R3 | Pydantic модель ответа, отдавать только нужные поля | NFR-10, NFR-04 | Unit/e2e: ответы соответствуют схеме |
| 2 | F2 GET /wishes/search | S — подмена запроса / подделка заголовков | R3 | Требовать авторизацию для защищённых действий (JWT/API key) | NFR-06 | e2e: доступ только с токеном/ключом |
| 3 | F3 POST /wishes | T — инъекция/скрипты в полях | R4 | Валидация + очистка текста (sanitizer) | NFR-10 | Unit: вредоносный ввод очищается |
| 4 | F4 PUT /wishes/{id} | R — отсутствие аудита изменений | R6 | Логировать изменения (who/when/request_id) | NFR-04, NFR-10 | Логи содержат записи изменений |
| 5 | F5 DELETE /wishes/{id} | D — массовые/автоматические удаления | R5 | Rate limit на удаление; soft-delete | NFR-08, NFR-03 | Нагрузочные тесты + метрики 429/5xx |
| 6 | GW (API Gateway) | S/E — подмена маршрутов или эскалация прав | R3, R10 | Проверка роутов, WAF, CORS, auth middleware | NFR-06, NFR-08 | Автотесты маршрутов; ZAP baseline |
| 7 | SVC (FastAPI) internal | E — повышение прав внутри сервиса | R10 | RBAC / проверка прав на уровне кода | NFR-06 | e2e: проверка ролей и доступов |
| 8 | DB (F7) | T — неавторизованное изменение данных | R2 | Защищённая БД, бэкапы, IAM | NFR-07, NFR-05 | Тест восстановления из бэкапа |
| 9 | DB (F7) | I — утечка из бэкапов / логов | R9 | Шифрование бэкапов, ограничить доступ | NFR-07 | Аудит доступа, проверка шифрования |
|10 | MON (F8) | I — логирование секретов | R6 | Маскирование секретов в логах, структурированные логи | NFR-04, NFR-10 | CI: скан логов; тесты маскировки |
|11 | In-memory `wishes_db` | D — гонки / неконсистентность | R8 | Перевести на БД или синхронизация/lock'и | NFR-09, NFR-03 | Load tests; code review |
|12 | CI/CD pipeline | T/I — уязвимые зависимости или образы | R7 | Snyk/Trivy в CI, policy-as-code | NFR-05 | CI: отчёты Snyk/Trivy |
|13 | Error responses (все) | I — подробные ошибки раскрывают детали | R6 | Единый обработчик ошибок; не возвращать stacktrace в проде | NFR-04, NFR-10 | Contract tests; ручная проверка |
|14 | Поле `link` / файлы | I/T — вредоносные ссылки / скачивания | R4 | Валидация URL; очистка/рекомендации (rel="noopener") | NFR-10 | Unit tests валидации URL |
