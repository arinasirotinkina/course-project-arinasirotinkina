# NFR_BDD.md — Приёмка в формате Gherkin

BDD-сценарии (Gherkin) для ключевых NFR проекта **Wishlist API**.

---

Feature: NFR-01 — Время ответа API (p95)
Scenario: p95 для read-эндпоинтов в нормальной нагрузке
  Given сервис развернут в тестовой среде и инструменты мониторинга (Prometheus) подключены
  And создаётся синтетический трафик на эндпоинты GET /wishes и GET /wishes/{id} с темпом 200 RPS в течение 30 минут
  When собираются метрики latency (histogram/summary) для этих эндпоинтов
  Then p95 времени ответа для GET /wishes и GET /wishes/{id} ≤ 200 ms

Scenario: деградация при перегрузке (негативный)
  Given сервис развернут в тестовой среде и инструменты мониторинга подключены
  And создаётся пиковый трафик 1000 RPS в течение 15 минут
  When собираются метрики latency
  Then p95 времени ответа для GET /wishes и GET /wishes/{id} > 200 ms (ожидаемое нарушение; система должна корректно сигнализировать alert)

---

Feature: NFR-03 — Доступность (SLA)
Scenario: проверка месячной доступности в соответствии с SLA
  Given внешний мониторинг (UptimeRobot / Pingdom) настроен и проверяет корневой путь "/" каждые 1 минуту
  When собранный за последний календарный месяц отчёт показывает суммарное время простоя
  Then месячная доступность сервиса ≥ 99.9% (Downtime ≤ 0.1% месяца)

Scenario: эмуляция инцидента и проверка алертов (негативный)
  Given имитируется отказ сервиса (service unavailable) на 45 минут в течение месяца
  When собирается отчёт мониторинга за месяц
  Then месячная доступность сервиса < 99.9% и сработал критический алерт в Alertmanager

---

Feature: NFR-04 — Процент ошибок (error rate)
Scenario: удержание процента 5xx в норме
  Given сервис обрабатывает реальную/тестовую нагрузку в течение 24 часов
  When собираются метрики ошибок (код ответа)
  Then доля ответов с 5xx ≤ 0.5% за 24 часа

Scenario: реакция на spike ошибок (негативный)
  Given в тестовой нагрузке искусственно вызываются внутренние ошибки (например, throw 500 для 1% запросов)
  When метрики показывают рост 5xx
  Then доля ответов 5xx > 0.5% и автоматически создаётся инцидент / срабатывает alert

---
